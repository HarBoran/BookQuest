<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5">

<head>

	<head th:replace="commonspace :: page_head('Home - Book Quest')" />
</head>


<script type="text/javascript">
	$(document).ready(function () {
		$("#buttonCancel").on("click", function () {
			window.location = "[[@{/users}]]";
		});

		$("#fileImage").change(function () {
			fileSize = this.files[0].size;
			if (fileSize > 1048576) {
				this.setCustomValidity("Tou must choose an image less than 1MB@");
				this.reportValidity();
			} else {
				this.setCustomValidity("");
				showImageThumbnail(this);
			}
		});
	});
	function showImageThumbnail(fileInput) {
		var file = fileImput.files[0];
		var reader = new fileReader();
		reader.onload = function (e) {
			$("#thumbnail").attr("src", e.target.result);
		};
		reader.readAsDataURL(file);
	}
	$("#fileImage").change(function () {
		fileSize = this.files[0].size;
		if (fileSize > 1048576) {
			this.setCustomValidity("Tou must choose an image less than 1MB@");
			this.reportValidity();
		} else {
			this.setCustomValidity("");
			showImageThumbnail(this);
		}
	});
	function showImageThumbnail(fileInput) {
		var file = fileInput.files[0];
		var reader = new FileReader();
		reader.onload = function (e) {
			$("#thumbnail").attr("src", e.target.result);
		};
		reader.readAsDataURL(file);
	}
	function checkEmailUnique(form) {
		url = "[[@{/Sign/check_email}]]";
		userId = $("#id").val();
		userEmail = $("#email").val();
		csrfValue = $("input[name='_csrf']").val();
		params = {id: userId, email: userEmail, _csrf: csrfValue};

		$.post(url, params, function (response) {
			if (response == "OK") {
				form.submit();
			} else if (response == "Duplicated") {
				showModalDialog("Warning", userEmail + " is alread exist!!");
			} else {
				showModalDialog("Error", "Unknown response from server");
			}
		}).fail(function () {
			showModalDialog("Error", "Could not connect to the server");
		});
		return false;
	}
	function showModalDialog(title, message) {
		$("#modalTitle").text(title);
		$("#modalBody").text(message);
		$("#modalDialog").modal();
	}

</script>

</head>


<body>
	<div th:replace="commonspace :: menu" />


	<div class="container">
		<h2>Stacked form</h2>
		<form th:action="@{/sign/save}" th:object="${user}" method="post" enctype="multipart/form-data"
			onsubmit="return checkEmailUnique(this)" ;>
			<input type="hidden" th:field="*{userId}" />

			<div class="form-group">
				<label for="email">Email:</label>
				<input type="text" th:field="*{email}" class="form-control" placeholder="Enter email" required>
			</div>

			<div class="form-group">
				<label for="email">Password:</label>
				<input type="text" th:field="*{password}" class="form-control" id="email" placeholder="Enter password">
			</div>

			<div class="form-group">
				<label for="email">address:</label>
				<input type="text" th:field="*{address}" class="form-control" id="email" placeholder="Enter address">
			</div>

			<div class="form-group">
				<label for="email">name:</label>
				<input type="text" th:field="*{name}" class="form-control" id="email" placeholder="Enter name">
			</div>


			<div class="form-group">
				<label for="email">phone:</label>
				<input type="text" th:field="*{phone}" class="form-control" id="email" placeholder="Enter phone">
			</div>

			<!--     <div class="form-group">
      <label for="email">photo:</label>
      <input type="text" th:field="*{photo}" class="form-control" id="email" placeholder="Enter photo">
    </div>-->

			<div class="form=group row">
				<label class="col-sm-4 col-form-label">photos:</label>
				<div class="col-sm-8">
					<input type="file" id="fileImage" name="image" accept="image/png, image/jpeg" class="mb-2" />
					<img id="thumbnail" alt="Photos preview" th:src="@{${user.photosImagePath}}" class="img-fluid" />
				</div>
			</div>

			<div class="form-group form-check">
				<label class="form-check-label">
					<input class="form-check-input" type="checkbox" th:field="*{enabled}"> Enabled:
				</label>
			</div>

			<button type="submit" class="btn btn-primary">Submit</button>
		</form>
	</div>


	<div class="modal fade text-center" id="modalDialog">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h4 class="modal-title" id="modalTitle">Warning</h4>
					<button type="button" class="close" data-dismiss="moadl">&times;</button>
				</div>
				<div class="modal-body">
					<span id="modalBody"></span>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>

	<div th:replace="commonspace :: footer" />
</body>

</html>