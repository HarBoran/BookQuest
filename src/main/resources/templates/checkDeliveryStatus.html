<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5">

<head>
	
	<head th:replace="commonspace :: page_head('Home - orderDetails')" />
	<link rel="stylesheet" th:href="@{/css/checkDeliveryStatus.css}" />
	<script type="text/javascript" th:src="@{/js/checkDeliveryStatus.js}"></script>

</head>

<script>
	function toggleOrderDetailTable(event) {
	  var div = document.getElementById("orderDetailTable");
	  //event.preventDefault();
	  if (div.style.display === "none") {
	    div.style.display = "block";
	  } else {
	    div.style.display = "none";
	  }
	}
</script>

<body>
	<div th:replace="commonspace :: menu" />
	
	<form th:action="@{/admin/checkDeliveryStatus}" method="POST">
		<div class="container" style="text-align: center;">
			<br><br>
			<h1>판매 내역</h1>
			<br><br>

			<button type="submit" class="btn btn-primary btn-sm">배송상태 변경</button>
			<select name="deliveryStatus" onchange="this.form.submit()">
				<option value="" hidden>배송상태를 선택 하세요</option>
				<option value="배송준비중" th:selected="${deliveryStatus == '배송준비중'}">배송준비중</option>
				<option value="배송완료" th:selected="${deliveryStatus == '배송완료'}">배송완료</option>
				<option value="전체" th:selected="${deliveryStatus == '전체'}">전체</option>
			</select>
		    
			<table>
				<tr>
					<th>SalesID</th>
					<th>판매자</th>
					<th>판매일</th>
					<th>판매시간</th>
					<th>배송상태</th>
					<th>결제가격</th>
					<th>결제카드</th>
					<th>결제카드번호</th>
					<th>상세보기</th>	
				</tr>
			</table>
			<div th:each="order:${orderList}" class="text-center">
				<table>
					<tr>
						<td>
							<div th:text="${order.orderId}" />
						</td>
						<td>
							<div th:text="${order.user.name}" />
						</td>
						<td>
							<div th:text="${#temporals.format(order.orderDate, 'yy-MM-dd')}"></div>
						</td>
						<td>
							<div th:text="${#temporals.format(order.orderDate, 'HH:mm')}"></div>
						</td>
						<td><label>
								<input type="checkbox" th:if="${order.deliveryStatus=='배송준비중'}" 
									th:name="bookToChangeShippingStatus"
									th:value="${order.orderId}">
								<span th:text="${order.deliveryStatus}" />
							</label>
						</td>
						<td>
							<div th:text="${#numbers.formatDecimal(order.totalPrice, 0, 'COMMA', 0, 'POINT') + '원'}" />
						</td>
						<td>
							<div th:text="${order.payment.bank}" />
						</td>
						<td>
							<div th:text="${order.payment.accountNumber}" />
						</td>
						<td>
							<button type="button" id="toggleButton" class="btn btn-danger m-3" onclick="toggleOrderDetailTable(event)">상세보기</button>
						</td>
					</tr>
				</table>
				
				
				<div id="orderDetailTable" style="display:none; width: 80%; float: right;;">
					<table>
						<tr>
							<td>책이미지</td>
							<td>책제목</td>
							<td>가격</td>
							<td>수량</td>
							<td>총 판매 가격</td>
						</tr>
						<div th:each="orderDetail:${order.orderDetail}" class="text-center">
							<tr>
								<td>
									<img th:src="@{${orderDetail.book.imagePath}}" title="${orderDetail.book.image}" id="image_box">
								</td>
								<td th:text="${orderDetail.book.title}"></td>
								<td th:text="${#numbers.formatDecimal(orderDetail.price, 0, 'COMMA', 0, 'POINT') + '원'}"></td>
								<td th:text="${orderDetail.orderQuantity}"></td>
								<td th:text="${#numbers.formatDecimal(orderDetail.price*orderDetail.orderQuantity, 0, 'COMMA', 0, 'POINT') + '원'}"></td>
							</tr>
						</div>
					</table>
				</div>
			</div> <!--orderList 반복문 끝-->
		</div>  <!--컨테이너 끝-->
	</form>
	
	
	<div th:replace="commonspace :: footer" />

</body>

</html>